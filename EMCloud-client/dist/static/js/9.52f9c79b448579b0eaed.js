webpackJsonp([9],{hgIy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),n=a.n(r),s=a("exGp"),i=a.n(s),l={name:"Params.vue",data:function(){return{cateList:[],cascaderProps:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children"},selectedKeys:[],activeName:"",pTable:[],isDisabled:!1,addParamDialogVisible:!1,paramInfo:{attr_name:"",attr_sel:"many"},ParamRules:{attr_name:[{required:!0,message:"请输入动态参数名称",trigger:"blur"}]},editParamDialogVisible:!1,editInfo:{},valsList:[],inputVisible:!1,inputValue:""}},created:function(){this.getCateList()},methods:{getCateList:function(){var e=this;return i()(n.a.mark(function t(){var a,r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("categories",{params:{type:3}});case 2:if(a=t.sent,200===(r=a.data).meta.status){t.next=6;break}return t.abrupt("return",e.$message.error("获取分类失败"));case 6:e.cateList=r.data,e.$message.success("获取分类成功");case 8:case"end":return t.stop()}},t,e)}))()},showTable:function(e){var t=this;return i()(n.a.mark(function a(){var r,s;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(3!=t.selectedKeys.length){a.next=10;break}return a.next=3,t.$http.get("categories/"+t.selectedKeys[2]+"/attributes",{params:{sel:e}});case 3:if(r=a.sent,200===(s=r.data).meta.status){a.next=7;break}return a.abrupt("return",t.$message.error("获取参数列表失败"));case 7:s.data.forEach(function(e){e.attr_vals=e.attr_vals?e.attr_vals.split(" "):[],e.inputVisible=!1,e.inputValue=""}),t.pTable=s.data,t.$message.success("获取参数列表成功");case 10:case"end":return a.stop()}},a,t)}))()},handleChange:function(){0==this.selectedKeys.length?this.isDisabled=!0:this.isDisabled=!1},showAddParamDialog:function(){this.addParamDialogVisible=!0},addParam:function(){var e,t=this;this.$refs.addParamFormRef.validate((e=i()(n.a.mark(function e(a){var r;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$http.post("categories/"+t.selectedKeys[2]+"/attributes",{attr_name:t.paramInfo.attr_name,attr_sel:t.paramInfo.attr_sel});case 4:if(r=e.sent,201===r.data.meta.status){e.next=8;break}return e.abrupt("return",t.$message.error("添加失败"));case 8:t.showTable(t.paramInfo.attr_sel),t.addParamDialogVisible=!1,t.$message.success("添加成功");case 11:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},addParamDialogClose:function(){this.$refs.addParamFormRef.resetFields(),this.selectedKeys=[],this.paramInfo.attr_name=""},deleteParam:function(e){var t=this;this.$confirm("此操作将永久删除该参数, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(i()(n.a.mark(function a(){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$http.delete("categories/"+t.selectedKeys[2]+"/attributes/"+e.attr_id);case 2:if(r=a.sent,200===r.data.meta.status){a.next=6;break}return a.abrupt("return",t.$message.error("删除失败"));case 6:t.showTable("many"),t.$message({type:"success",message:"删除成功!"});case 8:case"end":return a.stop()}},a,t)}))).catch(function(){t.$message({type:"info",message:"已取消删除"})})},showEditParamDialog:function(e){this.editInfo=e,console.log(this.editInfo),this.editParamDialogVisible=!0},editParam:function(){var e,t=this;this.$refs.editParamFormRef.validate((e=i()(n.a.mark(function e(a){var r;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$http.put("categories/"+t.selectedKeys[2]+"/attributes/"+t.editInfo.attr_id,{attr_name:t.editInfo.attr_name,attr_sel:t.editInfo.attr_sel});case 4:if(r=e.sent,200===r.data.meta.status){e.next=8;break}return e.abrupt("return",t.$message.error("修改失败"));case 8:t.showTable(t.editInfo.attr_sel),t.editParamDialogVisible=!1,t.$message.success("修改成功");case 11:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},editParamDialogClose:function(){},showInput:function(e){e.inputVisible=!0},handleInputConfirm:function(e){e.inputValue.trim()&&(e.attr_vals.push(e.inputValue.trim()),this.updateParamDetail(e)),e.inputValue="",e.inputVisible=!1},updateParamDetail:function(e){var t=this;return i()(n.a.mark(function a(){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$http.put("categories/"+t.selectedKeys[2]+"/attributes/"+e.attr_id,{attr_name:e.attr_name,attr_sel:e.attr_sel,attr_vals:e.attr_vals.join(" ")});case 2:if(r=a.sent,200===r.data.meta.status){a.next=6;break}return a.abrupt("return",t.$message.error("更新明细失败"));case 6:t.$message.success("更新明细成功");case 7:case"end":return a.stop()}},a,t)}))()},handleClose:function(e,t){e.attr_vals.splice(t,1),this.updateParamDetail(e)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),a("el-breadcrumb-item",[e._v("商品管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("分类参数")])],1),e._v(" "),a("el-card",{staticClass:"box-card"},[a("el-row",[a("el-col",[a("el-alert",{attrs:{title:"注意：只允许为第三级分类设置相关参数！",type:"warning"}})],1)],1),e._v(" "),a("el-row",{staticClass:"cascader"},[a("el-col",[a("span",[e._v("选择商品分类")]),e._v(" "),a("el-cascader",{attrs:{options:e.cateList,props:e.cascaderProps,clearable:""},on:{handleChange:e.handleChange},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1)],1),e._v(" "),a("el-tabs",{staticClass:"el-tabs",on:{"tab-click":function(t){return e.showTable(e.activeName)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"动态参数",name:"many"}},[a("el-button",{attrs:{type:"primary",disabled:e.isDisabled},on:{click:function(t){return e.showAddParamDialog()}}},[e._v("添加参数")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.pTable,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"expand",label:"明细"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.attr_vals,function(r,n){return a("el-tag",{key:r,staticClass:"el-tag",attrs:{closable:""},on:{close:function(a){return e.handleClose(t.row,n)}}},[e._v("\r\n                "+e._s(r)+"\r\n              ")])}),e._v(" "),t.row.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(a){return e.handleInputConfirm(t.row)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleInputConfirm(t.row)}},model:{value:t.row.inputValue,callback:function(a){e.$set(t.row,"inputValue",a)},expression:"scope.row.inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(a){return e.showInput(t.row)}}},[e._v("+ New Tag")])]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{label:"参数名称",prop:"attr_name"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(a){return e.showEditParamDialog(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(a){return e.deleteParam(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"静态属性",name:"only"}},[a("el-button",{attrs:{type:"primary",disabled:e.isDisabled}},[e._v("添加属性")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.pTable,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"expand",label:"明细"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.attr_vals,function(r,n){return a("el-tag",{key:r,staticClass:"el-tag",attrs:{closable:""},on:{close:function(a){return e.handleClose(t.row,n)}}},[e._v("\r\n                "+e._s(r)+"\r\n              ")])}),e._v(" "),t.row.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(a){return e.handleInputConfirm(t.row)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleInputConfirm(t.row)}},model:{value:t.row.inputValue,callback:function(a){e.$set(t.row,"inputValue",a)},expression:"scope.row.inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(a){return e.showInput(t.row)}}},[e._v("+ New Tag")])]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{label:"属性名称",prop:"attr_name"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"}},[e._v("删除")])],1)],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加参数",visible:e.addParamDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addParamDialogVisible=t},close:e.addParamDialogClose}},[a("el-form",{ref:"addParamFormRef",attrs:{model:e.paramInfo,rules:e.ParamRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"动态参数",prop:"attr_name"}},[a("el-input",{model:{value:e.paramInfo.attr_name,callback:function(t){e.$set(e.paramInfo,"attr_name",t)},expression:"paramInfo.attr_name"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addParamDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addParam}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改参数",visible:e.editParamDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editParamDialogVisible=t},close:e.editParamDialogClose}},[a("el-form",{ref:"editParamFormRef",attrs:{model:e.editInfo,rules:e.ParamRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"动态参数",prop:"attr_name"}},[a("el-input",{model:{value:e.editInfo.attr_name,callback:function(t){e.$set(e.editInfo,"attr_name",t)},expression:"editInfo.attr_name"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editParamDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.editParam}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(l,o,!1,function(e){a("undS")},"data-v-896b4208",null);t.default=u.exports},undS:function(e,t){}});
//# sourceMappingURL=9.52f9c79b448579b0eaed.js.json
